<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../template/newTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
                xmlns="http://www.w3.org/1999/xhtml" >
    <ui:define name="content">
        <f:event listener="#{userData.authorize}" type="preRenderView" />
        <h:head>
            <title>#{userData.userDDs['GLACCOUNT_MANAGEMENT']}</title>
        </h:head>
        <style>

            .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default {
                border: 1px solid #c5dbec;
                background:none;
            }

        </style>
        <f:event listener="#{userData.authorize}" type="preRenderView" />
        <p:fieldset legend="#{userData.userDDs['CHART_OF_ACCOUNT']}" style="margin-bottom:2px" styleClass="panelColumns">
            <h:form id="form" >
                <p:messages autoUpdate="true"  id="messages" showDetail="true" closable="true" rendered="#{glAccountBean.showMessage}"/>
                <div class="ui-g-12 ui-g-nopad">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-4">
                            <h:panelGroup style="width: 25%">
                                <p:tree value="#{glAccountBean.accountHierarchy}" var="acc" dir="#{userData.dir}"
                                        selectionMode="single" selection="#{glAccountBean.selectedAccount}"
                                        dynamic="false" id="csTree">
                                    <p:ajax event="select"  listener="#{glAccountBean.onNodeSelect}" update=":form:edit" />
                                    <p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed" >
                                        <h:outputText value="#{acc.name}" />
                                    </p:treeNode>
                                </p:tree>
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-8">
                            <h:panelGroup>
                                <p:fieldset legend="#{userData.userDDs['CHART_OF_ACCOUNT']}" style="margin-bottom:2px" 
                                            rendered="#{not(userData.userScreens['glaccount'].add or userData.userScreens['glaccount'].edit or userData.isAdmin)}">
                                    <h:panelGrid  id="view"  columns="4"   >

                                        <h:panelGroup>
                                            <p:outputLabel for="accountnum" value="#{userData.userDDs['ACCOUNT_NUMBER']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="accountnum"  value="#{glAccountBean.selectedAcc.accNumber}"  />
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="accountnum" value="#{userData.userDDs['ACCOUNT_NAME']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="accpname"  value="#{glAccountBean.selectedAcc.name}"  />
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="shortcode" value="#{userData.userDDs['SHORT_CODE']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="shortcode" value="#{glAccountBean.selectedAcc.shotCode}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="level" value="#{userData.userDDs['ACCOUNT_LEVEL']}"/>
                                        </h:panelGroup>

                                        <h:panelGroup> 
                                            <p:outputLabel id="level" value="#{glAccountBean.selectedAcc.levelAcc}" />
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="accgroup" value=" #{userData.userDDs['ACCOUNT_GROUP']}"/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="accgroup" value="#{glAccountBean.selectedAcc.accGroup}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="accmain" value="#{userData.userDDs['ACCOUNT_MAIN']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="accmain" value="#{glAccountBean.selectedAcc.parentAcc.name}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="accType" value="#{userData.userDDs['ACCOUNT_TYPE']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="accType" value="#{glAccountBean.selectedAcc.type}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="status" value="#{userData.userDDs['ACCOUNT_STATUS']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <h:selectBooleanCheckbox id="status" value="#{glAccountBean.selectedAcc.status}"  />
                                        </h:panelGroup> 

                                        <h:panelGroup>
                                            <p:outputLabel for="cost" value="#{userData.userDDs['COST_CENTER']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="cost" value="#{glAccountBean.selectedAcc.costCenter}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="adminunit" value="#{userData.userDDs['ADMIN_UNIT']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="adminunit" value="#{glAccountBean.selectedAcc.administrativeUnit}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="asaccount" value="#{userData.userDDs['ASSISTANT_ACCOUNT']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="asaccount" value="#{glAccountBean.selectedAcc.assistantAcc}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="helpacc" value="#{userData.userDDs['ACCOUNT_CLASS']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="helpacc" value="#{glAccountBean.selectedAcc.accClass}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="currency" value="#{userData.userDDs['ACCOUNT_CURRENCY']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="currency" value="#{glAccountBean.selectedAcc.currencyId.name}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="daccount" value="#{userData.userDDs['DEBIT_AMOUNT']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="daccount" value="#{glAccountBean.selectedAcc.debitAmount}"  />  
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel for="caccount" value="#{userData.userDDs['CREDIT_AMOUNT']}  "/>
                                        </h:panelGroup>

                                        <h:panelGroup>
                                            <p:outputLabel id="caccount" value="#{glAccountBean.selectedAcc.creditAmount}"  />  
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </p:fieldset>

                                <p:fieldset legend="#{userData.userDDs['CHART_OF_ACCOUNT']}" style="margin-bottom:2px" rendered="#{userData.userScreens['glaccount'].add or userData.userScreens['glaccount'].edit or userData.isAdmin}">

                                    <h:panelGrid  id="edit"    class="col-md-12" columns="1" >


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ACCOUNT_COD']}"/>
                                            </h:panelGroup>

                                            <h:panelGroup rendered="#{not glAccountBean.visibalitiy}">
                                                <p:inputText style="width: 50%!important" id="acc_num" a:autofocus="true" value="#{glAccountBean.selectedAcc.accNumber}"  >
                                                    <p:ajax event="blur" listener="#{glAccountBean.validateAccountNumberInputDublication}" update="form" />
                                                </p:inputText>

                                            </h:panelGroup>

                                            <h:panelGroup rendered="#{glAccountBean.visibalitiy}">
                                                <p:outputLabel style="width: 50%!important" id="acc_num2" a:autofocus="true" value="#{glAccountBean.selectedAcc.accNumber}"/>
                                            </h:panelGroup>
                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel   style="width: 13%" value="#{userData.userDDs['ACCOUNT_NAME']}"/>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:inputText style="width: 50%!important" id="acc_name" value="#{glAccountBean.selectedAcc.name}"  />

                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel   style="width: 13%" value="#{userData.userDDs['SHORT_CODE']}  "/>
                                            </h:panelGroup>

                                            <h:panelGroup>
                                                <p:inputText style="width: 50%!important" value="#{glAccountBean.selectedAcc.shotCode}" />  
                                            </h:panelGroup>

                                        </h:panelGroup>



                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ACCOUNT_LEVEL']}"/>
                                            </h:panelGroup>

                                            <h:panelGroup> 
                                                <p:outputLabel id="accLevel" value="#{glAccountBean.selectedAcc.levelAcc}" style="margin-right: 2%" />
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value=" #{userData.userDDs['ACCOUNT_GROUP']}"/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu id="accgrp" style="width: 50%!important;" value="#{glAccountBean.selectedAcc.accGroup}"  required="true" requiredMessage="#{userData.userDDs['REQUIRED']}" >
                                                    <f:selectItems value="#{glAccountBean.accountGroups}" 
                                                                   var="grp" itemLabel="#{userData.userDDs[''+= grp]}" 
                                                                   itemValue="#{grp}"/> 
                                                    <p:ajax  listener="#{glAccountBean.fillAccountsByBranch()}" update="parentAccount" />
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                        </h:panelGroup>



                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ACCOUNT_MAIN']} "/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu style="width:50%;margin:1% 1px" id="parentAccount" value="#{glAccountBean.selectedParentId}"               
                                                                 required="false" filter="true" filterMatchMode="contains" >
                                                    <p:ajax listener="#{glAccountBean.selectParent}" process="@this" update=":form:accgrp :form:accLevel :form:accCC :form:accAdminUnit :form:accAssisst :form:accClass :form:currencies" />
                                                    <f:selectItem itemLabel="#{userData.userDDs['CHOOSE']}" itemValue="" />
                                                    <f:selectItems value="#{glAccountBean.allAccounts}" var="acc" itemLabel="#{acc.name}" itemValue="#{acc.id}" />
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                        </h:panelGroup>



                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ACCOUNT_TYPE']}  "/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu style="width: 50%!important;margin: 1% 1px" id="accountParent" value="#{glAccountBean.selectedAcc.type}" >
                                                    <f:selectItem itemLabel="#{userData.userDDs['ACCOUNT_MAIN']}" itemValue="0" />
                                                    <f:selectItem itemLabel="#{userData.userDDs['SUBACCOUNT']}" itemValue="1" />
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ACCOUNT_STATUS']}  "/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <h:selectBooleanCheckbox  style="margin-right: 1%" value="#{glAccountBean.selectedAcc.status}"/>
                                            </h:panelGroup> 

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel  style="width: 13%" value="#{userData.userDDs['SINGLE_COST_CENTER']}  "/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu id="accCC" 
                                                                 style="width: 50%!important;margin:1% 1px"
                                                                 value="#{glAccountBean.selectedAcc.costCenter}"  
                                                                 required="true" 
                                                                 requiredMessage="#{userData.userDDs['REQUIRED']}" >
                                                    <f:selectItems value="#{glAccountBean.costCenterDependant}"
                                                                   var="costCenter"
                                                                   itemLabel="#{userData.userDDs[''+= costCenter]}" 
                                                                   itemValue="#{costCenter}"/> 
                                                </p:selectOneMenu>
                                            </h:panelGroup>


                                        </h:panelGroup>


                                        <h:panelGroup>
                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ADMIN_UNIT']}" />
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu style="width: 50%!important;margin:1% 1px" id="accAdminUnit" value="#{glAccountBean.selectedAcc.administrativeUnit}" 
                                                                 required="true" requiredMessage="#{userData.userDDs['REQUIRED']}" >
                                                    <f:selectItems value="#{glAccountBean.administrativeUnitDependant}"
                                                                   var="adminUnit" itemLabel="#{userData.userDDs[''+= adminUnit]}"
                                                                   itemValue="#{adminUnit}"/> 
                                                </p:selectOneMenu> 
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>
                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ASSISTANT_ACCOUNT']}"/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu style="width: 50%!important;margin:1% 1px"  id="accAssisst" value="#{glAccountBean.selectedAcc.assistantAcc}">
                                                    <f:selectItems value="#{glAccountBean.assisstantAccount}" 
                                                                   var="assisstAcc" itemLabel="#{userData.userDDs[''+= assisstAcc]}" 
                                                                   itemValue="#{assisstAcc}"/> 
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel  style="width: 13%" value="#{userData.userDDs['ACCOUNT_CLASS']}  "/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu  style="width: 50%!important;margin:1% 1px"  id="accClass" value="#{glAccountBean.selectedAcc.accClass}"  required="true" requiredMessage="#{userData.userDDs['REQUIRED']}" >
                                                    <f:selectItems value="#{glAccountBean.accountClass}" var="accClass" itemLabel="#{userData.userDDs[''+= accClass]}" itemValue="#{accClass}"/> 
                                                </p:selectOneMenu> 
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['ACCOUNT_CURRENCY']}  "/>
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:selectOneMenu style="width: 50%!important;margin:1% 1px"  id="currencies" value="#{glAccountBean.selectedCurrencyId}" required="true" requiredMessage="#{userData.userDDs['REQUIRED']}" >
                                                    <f:selectItems value="#{glAccountBean.currencyList}" var="currency" itemLabel="#{currency.name}" itemValue="#{currency.id}"/> 
                                                </p:selectOneMenu>
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>
                                            <h:panelGroup>
                                                <p:outputLabel style="width: 13%" value="#{userData.userDDs['DEBIT_AMOUNT']}" />
                                            </h:panelGroup>
                                            <h:panelGroup>
                                                <p:outputLabel value="#{glAccountBean.selectedAcc.debitAmount}" style="margin-right: 1%" />  
                                            </h:panelGroup>

                                        </h:panelGroup>


                                        <h:panelGroup>

                                            <h:panelGroup>
                                                <p:outputLabel  style="width: 13%" value="#{userData.userDDs['CREDIT_AMOUNT']}  "  />
                                            </h:panelGroup>
                                            <h:panelGroup> 
                                                <p:outputLabel value="#{glAccountBean.selectedAcc.creditAmount}" style="margin-right: 1%" />  
                                            </h:panelGroup>

                                        </h:panelGroup>

                                        <h:panelGroup></h:panelGroup>




                                        <p:dialog id="dlg" style="text-align: right" header="#{userData.userDDs['CHOOSE_ACCOUNT']}" widgetVar="dlg" modal="true" dynamic="true">
                                            <h:form>
                                                <h:panelGrid  id="edit"   columns="2" >
                                                    <h:panelGroup>
                                                        <p:autoComplete style="width:400px" id="GlAccount_ID" 
                                                                        dropdown="true"
                                                                        scrollHeight="350"
                                                                        converter="#{glAccountBean.accountConverter}"
                                                                        value="#{glAccountBean.glAccountSelected}"
                                                                        var="p"
                                                                        itemLabel="#{p}" 
                                                                        itemValue="#{p}" 
                                                                        forceSelection="true" 
                                                                        completeMethod="#{glAccountBean.completeGlAccount}" >
                                                            <p:ajax event="itemSelect" listener="#{glAccountBean.setValueToTheSelectedObject}"  />
                                                        </p:autoComplete>
                                                    </h:panelGroup>

                                                    <h:panelGroup>
                                                        <p:commandButton   value="#{userData.userDDs['UPLOAD_DATA']}" onclick="PF('dlg').hide();">
                                                            <p:ajax event="click" listener="#{glAccountBean.searchForGlAccount}" update="form" />
                                                        </p:commandButton>
                                                    </h:panelGroup>
                                                </h:panelGrid>
                                            </h:form>
                                        </p:dialog>

                                        <h:panelGroup>
                                            <div class="centerButtons">

                                                <p:commandButton class="saveButton" 
                                                                 title="#{userData.userDDs['SAVE']}"
                                                                 value="#{userData.userDDs['SAVE']}"
                                                                 icon="fa fa-fw fa-save"
                                                                 action="#{glAccountBean.save()}" update="@form" 
                                                                 rendered="#{userData.userScreens['glaccount'].add or userData.isAdmin}"
                                                                 id="saveB"/>

                                                <p:commandButton class="searchButton"  icon="fa fa-fw fa-search-plus"   
                                                                 value="#{userData.userDDs['SEARCH']}"
                                                                   rendered="#{userData.userScreens['glaccount'].view or userData.isAdmin}"
                                                                 type="button" onclick="PF('dlg').show();"/>

                                                <p:commandButton class="addButton"
                                                                 title="#{userData.userDDs['ADD']}" 
                                                                 value="#{userData.userDDs['ADD']}"
                                                                 rendered="#{userData.userScreens['glaccount'].add or userData.isAdmin}" 
                                                                 action="#{glAccountBean.add}" icon="fa fa-fw fa-plus" id="plus"
                                                                 update=":form:edit" process="@this"/>

                                                <p:commandButton class="reloadButton" 
                                                                 value="#{userData.userDDs['UPLOAD']}"
                                                                 title="#{userData.userDDs['UPLOAD']}"
                                                                 icon="fa fa-fw fa-undo"  
                                                                 action="#{glAccountBean.reset}" 
                                                                 update="form" id="undo"/>


                                                <p:blockUI block="form" trigger="saveB plus undo" animate="true" >

                                                    <p:graphicImage library="img" name="9wcA.gif" ></p:graphicImage>

                                                </p:blockUI>

                                                <p:commandButton  class="deleteButton"  title="#{userData.userDDs['DELETE']}" 
                                                                  value="#{userData.userDDs['DELETE']}" 
                                                                  immediate="true" icon="fa fa-fw fa-remove"  
                                                                  action="#{glAccountBean.delete()}" update="@form"
                                                                   rendered="#{userData.userScreens['glaccount'].delete or userData.isAdmin}">
                                                    <p:confirm header="#{userData.userDDs['COFIGRATION']}" message="#{userData.userDDs['ARE_YOU_SURE']}" icon="ui-icon-alert" />
                                                </p:commandButton>
                                                
                                                <p:commandButton class="closeButton" 
                                                                 title="#{userData.userDDs['CANCEL']}" 
                                                                 immediate="true" 
                                                                 value="#{userData.userDDs['CANCEL']}" 
                                                                 icon="fa fa-fw fa-backward" 
                                                                 action="exit"   />
                                                
                                            </div>
                                        </h:panelGroup>
                                        <h:panelGroup>

                                            <h:panelGroup rendered="#{userData.isAdmin}">
                                                <p:outputLabel  value="#{userData.userDDs['COMPANY_NAME']}" />  
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{userData.isAdmin}">
                                                <p:outputLabel a:autofocus="true" value="#{glAccountBean.selectedAcc.companyId.name}" />  
                                            </h:panelGroup>

                                        </h:panelGroup>
                                    </h:panelGrid>
                                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                        <p:commandButton title="#{userData.userDDs['YES']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                        <p:commandButton title="#{userData.userDDs['NO']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                    </p:confirmDialog>
                                </p:fieldset>
                            </h:panelGroup>
                        </div>
                    </div>
                </div>

            </h:form>
        </p:fieldset>
    </ui:define>
</ui:composition>