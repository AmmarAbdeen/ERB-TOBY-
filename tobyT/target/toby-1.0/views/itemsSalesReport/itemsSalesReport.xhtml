<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../template/newTemplate.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:define name="content">
        <f:event listener="#{userData.authorize}" type="preRenderView" />
        <h:form id="form"  enctype="multipart/form-data"  dir="#{userData.dir}"  style="margin-right: 20px">

            <div >
                <p:messages id="curmsg" autoUpdate="true" showDetail="true" rendered="true" closable="true"/>   
            </div>

            <p:fieldset style="padding: 0 5px" legend="تقرير مبيعات الأصناف"> 



                <h:panelGrid id="firstSegment" columns="2" cellspacing="10" cellpadding="0" >




                    <h:panelGroup>

                        <p:outputLabel style="width: 80px" id="purchId" value="رقم الفاتورة" />
                        <p:outputLabel style="width: 80px" 
                                       id="purchIdVal"
                                       value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.serial}" />

                    </h:panelGroup>

                    <h:panelGroup>

                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="#{userData.userDDs['DATE']}*"/>
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:calendar id="dateFrom" 
                                        disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                        value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.date}"
                                        pattern="MM/dd/yyyy"
                                        required="true"
                                        style="width:47%!important"/>
                        </h:panelGroup>

                    </h:panelGroup>

                    <h:panelGroup>

                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="نوع الفاتورة "/>
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:selectOneMenu style="width: 48%"
                                             id="console"
                                             disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                             value ="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.paymentType}"  >                                                             
                                <f:selectItem itemLabel="نقدي"  itemValue="0"  />                            
                                <f:selectItem itemLabel="اجل" itemValue="1" />
                                <f:selectItem itemLabel="اعتماد مستندي" itemValue="2" />

                                <p:ajax event="valueChange" update=":form:firstSegment" listener="#{invPurchaseInvoiceFormMB.showDuDate}"/>
                            </p:selectOneMenu>                  
                        </h:panelGroup>

                    </h:panelGroup>





                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="رقم فاتورة المورد"/>
                        </h:panelGroup>

                        <h:panelGroup>
                            <p:inputText value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.supplierInvoiceNumber}" 
                                         disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                         style="width: 47.5%!important"/>
                        </h:panelGroup>
                    </h:panelGroup>



                    <h:panelGroup rendered="#{invPurchaseInvoiceFormMB.viewDuDate}">

                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="تاريخ الاسنحقاق"/>
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:calendar value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.dueDate}"
                                        disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                        pattern="MM/dd/yyyy"
                                        style="width:47.5%"/>
                        </h:panelGroup>

                    </h:panelGroup>

                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="#{userData.userDDs['SUPPLIER']}"/>
                        </h:panelGroup> 

                        <h:panelGroup>
                            <p:autoComplete style="width:69%!important" 
                                            dropdown="true"
                                            required="true"
                                            converter="#{invPurchaseInvoiceFormMB.supplierConvertor}"
                                            value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.supplierId}"

                                            var="supplier"
                                            itemLabel="#{supplier}" 
                                            itemValue="#{supplier}" 
                                            forceSelection="true" 
                                            completeMethod="#{invPurchaseInvoiceFormMB.completeSuppllier}" 
                                            disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}">


                                <p:ajax update="@form"
                                        event="change"
                                        process="@form"
                                        listener="#{invPurchaseInvoiceFormMB.putCurrency}" />
                                <p:ajax update="@form"
                                        process="@form"
                                        event="itemSelect"
                                        listener="#{invPurchaseInvoiceFormMB.putCurrency}" />


                            </p:autoComplete>
                        </h:panelGroup> 

                    </h:panelGroup>

                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="مندوب المشتريات"/>
                        </h:panelGroup> 

                        <h:panelGroup>
                            <p:autoComplete style="width:69%!important " 
                                            dropdown="true"
                                            converter="#{invPurchaseInvoiceFormMB.purchasePersonConvertor}"
                                            value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.purchasePerson}"

                                            var="purchasePerson"
                                            itemLabel="#{purchasePerson}" 
                                            itemValue="#{purchasePerson}" 
                                            forceSelection="true" 
                                            completeMethod="#{invPurchaseInvoiceFormMB.completePurchasePerson}"
                                            disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}">

                            </p:autoComplete>
                        </h:panelGroup> 
                    </h:panelGroup>


                    <h:panelGroup>

                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="التكلفة الاضافية"/>
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:inputNumber onblur="#{invPurchaseInvoiceFormMB.updateSummition()}"
                                           value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.extraCost}"
                                           disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                           style="width: 47%">

                                <p:ajax event="blur" 
                                        update="@form"
                                        process="@form" 
                                        listener="#{invPurchaseInvoiceFormMB.updateSummition()}" />
                            </p:inputNumber>
                        </h:panelGroup>

                    </h:panelGroup>





                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel  style="width: 80px" value="تاريخ فاتورة المورد"/>
                        </h:panelGroup>

                        <h:panelGroup>
                            <p:calendar pattern="dd/MM/yyyy" 
                                        value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.supplierInvoiceDate}"
                                        disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                        style="width: 48%">
                                <p:ajax event="dateSelect"
                                        process="@form" 
                                        update="@form" 
                                        listener="#{invPurchaseInvoiceFormMB.updateDate}" />
                            </p:calendar>
                        </h:panelGroup>
                    </h:panelGroup>


                    <h:panelGroup id="currencyPanelGroup">

                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="#{userData.userDDs['CURRENCY']}"/>
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" 
                                           value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.currencyId}"/>
                        </h:panelGroup>


                    </h:panelGroup>


                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="#{userData.userDDs['SINGLE_COST_CENTER']}"/>                        
                        </h:panelGroup>

                        <h:panelGroup>
                            <p:autoComplete style="width:69%" 
                                            dropdown="true"
                                            converter="#{invPurchaseInvoiceFormMB.costCenterConverter}"
                                            value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.costCenterId}"

                                            var="CostCenter"
                                            itemLabel="#{CostCenter}" 
                                            itemValue="#{CostCenter}" 
                                            forceSelection="true" 
                                            completeMethod="#{invPurchaseInvoiceFormMB.completeCostCenters}" 
                                            disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}">


                            </p:autoComplete>
                        </h:panelGroup>
                    </h:panelGroup>


                    <h:panelGroup>
                        <h:panelGroup id="exchangeRate">
                            <p:outputLabel style="width: 80px" value="المعدل"/>
                        </h:panelGroup>

                        <h:panelGroup id="CurrencyRate">
                            <p:outputLabel value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.rate}"/>
                        </h:panelGroup>
                    </h:panelGroup>


                    <h:panelGroup>

                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="#{userData.userDDs['ADMIN_UNIT']}"/>
                        </h:panelGroup>

                        <h:panelGroup>
                            <p:autoComplete style="width:69%"
                                            dropdown="true" 
                                            converter="#{invPurchaseInvoiceFormMB.adminUnitConverter}"
                                            value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.adminUnitId}"

                                            var="adminUnitId"
                                            itemLabel="#{adminUnitId}" 
                                            itemValue="#{adminUnitId}" 
                                            forceSelection="true" 
                                            completeMethod="#{invPurchaseInvoiceFormMB.completeAdminUnits}"
                                            disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}" >


                            </p:autoComplete>
                        </h:panelGroup>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{! invPurchaseInvoiceFormMB.viewDuDate}">
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="الخزيــــنة*"/>
                        </h:panelGroup> 

                        <h:panelGroup>
                            <p:autoComplete style="width:69%" 
                                            dropdown="true"
                                            required="true"
                                            converter="#{invPurchaseInvoiceFormMB.glBankConverter}"
                                            value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.glBank}"

                                            var="bank"
                                            itemLabel="#{bank}" 
                                            itemValue="#{bank}" 
                                            forceSelection="true" 
                                            completeMethod="#{invPurchaseInvoiceFormMB.completeGlBank}"
                                            disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}">

                            </p:autoComplete>
                        </h:panelGroup> 
                    </h:panelGroup>

                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="المخزن"/>
                        </h:panelGroup>

                        <h:panelGroup>
                            <p:autoComplete style="width:69%" 
                                            dropdown="true"
                                            converter="#{invPurchaseInvoiceFormMB.invInventoryConverter}"
                                            value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.invInventory}"
                                            required="true"
                                            var="inventory"
                                            itemLabel="#{inventory}" 
                                            itemValue="#{inventory}" 
                                            forceSelection="true" 
                                            completeMethod="#{invPurchaseInvoiceFormMB.completeInventory}" 
                                            disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}">


                            </p:autoComplete>
                        </h:panelGroup>
                    </h:panelGroup>

                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 80px" value="ملاحظات"/>
                        </h:panelGroup>

                        <h:panelGroup>
                            <p:inputText value="#{invPurchaseInvoiceFormMB.headRemarks}"
                                         disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"/>
                        </h:panelGroup>
                    </h:panelGroup>




                </h:panelGrid>

            </p:fieldset>

            <p:fieldset id="fieldSetId" legend="تفاصيل فاتورة الشراء"  style="margin-bottom:20px">


                <p:dataTable id="invPurchaseInvoiceDetailsTable"
                             widgetVar="invPurchaseInvoiceDetailsTable"
                             style="margin-bottom:20px"
                             var="invPurchaseInvoiceDetailsTable"
                             rowIndexVar="index" 
                             dir="rtl" 
                             emptyMessage="#{userData.userDDs['EMPTY_TABLE']}"
                             editable="true"
                             editMode="cell"
                             selectionMode="single"
                             sortBy="#{1}"
                             rowKey="#{invPurchaseInvoiceDetailsTable}"
                             selection="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceDetailsUpdatedSelected}"
                             value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceDetailsEntityList}" >

                    <f:facet name="header" >
                        <p:commandButton id="addnew"
                                         icon="fa fa-plus"
                                         title="#{userData.userDDs['ADD']}" 
                                         disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                         actionListener="#{invPurchaseInvoiceFormMB.addInvPurchaseInvoiceDetail()}" 
                                         update=":form:fieldSetId"  
                                         oncomplete="PrimeFaces.focus('form:invPurchaseInvoiceDetailsTable:'+#{invPurchaseInvoiceFormMB.invPurchaseInvoiceDetailsEntityList.size()}+':invItemNameIn')"
                                         immediate="true"
                                         ajax="true"
                                         style="float:right"/>
                        <p:outputPanel>
                            <h:outputText value="#{userData.userDDs['SEARCH']} : "  style="font-size: large" />
                            <p:inputText id="globalFilter" onkeyup="PF('invPurchaseInvoiceDetailsTable').filter()" style="width:150px" />
                        </p:outputPanel>
                    </f:facet>


                    <p:column headerText="#" style="width: 5vh;text-align: -webkit-auto" >
                        <h:outputText value="#{invPurchaseInvoiceDetailsTable.serial}"  />
                    </p:column>




                    <p:column style="width: 15vh;text-align: -webkit-auto" id="itemName" headerText="الصنف">
                        <p:autoComplete id="invItemNameIn"  

                                        style="width:95%"
                                        converter="#{invPurchaseInvoiceFormMB.itemsBarcodesDetailsViewConverter}"
                                        value="#{invPurchaseInvoiceDetailsTable.itemsBarcodesDetail}"

                                        var="item"
                                        itemLabel="#{item}" 
                                        itemValue="#{item}" 
                                        forceSelection="true" 
                                        completeMethod="#{invPurchaseInvoiceFormMB.completeItemsData}" >
                            <p:ajax update=" unitvalue QuantityT costTt discountT netId totalQuantity   totalNet form:totalNetAfterDiscount"
                                    event="itemSelect" listener="#{invPurchaseInvoiceFormMB.validateItems(invPurchaseInvoiceDetailsTable)}" />
                            <p:ajax update=" unitvalue QuantityT costTt discountT netId totalQuantity   totalNet form:totalNetAfterDiscount"
                                    event="change"     listener="#{invPurchaseInvoiceFormMB.validateItems(invPurchaseInvoiceDetailsTable)}" />



                        </p:autoComplete>            
                    </p:column>

                    <p:column  style="width: 12vh;text-align: -webkit-auto" id="Unit" headerText="#{userData.userDDs['UNIT_NUMBER']}">
                        <p:inputText id="unitvalue" readonly="true" value="#{invPurchaseInvoiceDetailsTable.itemsBarcodesDetail.unitName}" style="width: 95%" />                               
                    </p:column>


                    <p:column style="width: 12vh;text-align: -webkit-auto"
                              id="Quantity"
                              headerText="#{userData.userDDs['QUANTITY']}">
                        <p:inputText id="QuantityT"  
                                     value="#{invPurchaseInvoiceDetailsTable.quantity}" 
                                     disabled="#{invPurchaseInvoiceDetailsTable.itemsBarcodesDetail == null}"
                                     style="width:95%">
                            <p:ajax listener="#{invPurchaseInvoiceFormMB.validateQuantityColum(invPurchaseInvoiceDetailsTable)}" 
                                    update="netId totalQuantity  totalNet form:totalNetAfterDiscount"/>
                        </p:inputText>        

                    </p:column>

                    <p:column style="width: 14vh;text-align: -webkit-auto" id="COST" headerText="السعر">
                        <p:inputText id="costTt" 
                                     value="#{invPurchaseInvoiceDetailsTable.cost}"
                                     disabled="#{invPurchaseInvoiceDetailsTable.itemsBarcodesDetail == null}"
                                     style="width:95%">
                            <p:ajax listener="#{invPurchaseInvoiceFormMB.validatePriceColumn(invPurchaseInvoiceDetailsTable)}" 
                                    update="invPurchaseInvoiceDetailsTable form:totalNetAfterDiscount"/>
                        </p:inputText>       
                    </p:column>

                    <p:column style="width: 14vh;text-align: -webkit-auto" id="DISCOUNT" headerText="#{userData.userDDs['DISCOUNT']}">
                        <p:inputText id="discountT" 
                                     value="#{invPurchaseInvoiceDetailsTable.discount}" 
                                     disabled="#{invPurchaseInvoiceDetailsTable.itemsBarcodesDetail == null}"
                                     style="width:80%!important;display: inline!important">
                            <p:ajax listener="#{invPurchaseInvoiceFormMB.validateDiscountColumn(invPurchaseInvoiceDetailsTable)}"
                                    update="invPurchaseInvoiceDetailsTable form:totalNetAfterDiscount"/>
                        </p:inputText>  
                        <p:outputLabel value="%"  style="display: inline!important"  />
                    </p:column>


                    <p:column style="width: 12vh;text-align: -webkit-auto" id="net" headerText="الإجمالي">
                        <p:outputLabel id="netId" value="#{invPurchaseInvoiceDetailsTable.net}"   />
                    </p:column>

                    <p:summaryRow>
                        <p:column colspan="3" style="text-align:right">
                            <h:outputText style="text-align:right" value="#{userData.userDDs['TOTAL']}  :" />
                        </p:column>
                        <p:column>
                            <h:outputText id="totalQuantity" value="#{invPurchaseInvoiceFormMB.totalQuatity}"/>
                        </p:column>

                        <p:column />
                        <p:column />
                        <p:column>
                            <h:outputText id="totalNet" value="#{invPurchaseInvoiceFormMB.totalNet}"/>
                        </p:column>
                        <p:column />
                    </p:summaryRow>

                    <p:column style="width: 10vh;text-align: -webkit-auto" headerText="#{userData.userDDs['TRANSACTION']}">

                        <p:commandButton id="b7" icon="fa fa-plus" 
                                         title="#{userData.userDDs['ADD']}" 
                                         disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                         actionListener="#{invPurchaseInvoiceFormMB.addInvPurchaseInvoiceDetail}" 
                                         update=":form:fieldSetId"  
                                         immediate="true"
                                         oncomplete="PrimeFaces.focus('form:invPurchaseInvoiceDetailsTable:'+#{invPurchaseInvoiceFormMB.invPurchaseInvoiceDetailsEntityList.size()}+':invItemNameIn')"
                                         ajax="true" />

                        <p:commandButton update="invPurchaseInvoiceDetailsTable"
                                         title="#{userData.userDDs['DELETE']}" 
                                         disabled="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                         action="#{invPurchaseInvoiceFormMB.deleteInvPurchaseInvoiceDetail()}"
                                         icon="fa fa-remove" >

                            <f:setPropertyActionListener value="#{invPurchaseInvoiceDetailsTable}"
                                                         target="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceDetailsEntitySelected}"/>
                            <p:confirm header="#{userData.userDDs['COFIGRATION']}" 
                                       message="#{userData.userDDs['ARE_YOU_SURE']}"
                                       icon="ui-icon-alert" />
                        </p:commandButton>

                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton title="#{userData.userDDs['YES']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                            <p:commandButton title="#{userData.userDDs['NO']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                        </p:confirmDialog>
                    </p:column >

                </p:dataTable>



                <h:panelGrid  columns="3"  cellpadding="0" >


                    <h:panelGroup>

                        <h:panelGroup>

                            <h:panelGroup>
                                <p:outputLabel style="width: 50px" value="نوع الخصم "/>
                            </h:panelGroup>
                            <h:panelGroup>
                                <p:selectOneMenu style="width: 73%" id="PURCHASE_NUMBER" 

                                                 value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.discountType}"  >                                                             
                                    <f:selectItem itemLabel="قيمة"  itemValue="0"  />
                                    <f:selectItem itemLabel="نسبة"  itemValue="1"  />

                                    <p:ajax event="valueChange"
                                            update="form invPurchaseInvoiceDetailsTable :form:discount"
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.updateSummition()}" />
                                </p:selectOneMenu>                  
                            </h:panelGroup>

                        </h:panelGroup>



                    </h:panelGroup>  



                    <h:panelGroup style="margin-right: 35px">
                        <h:panelGroup>
                            <p:outputLabel style="width: 70px" value="خصم على الفاتورة"/>
                        </h:panelGroup>
                        <h:panelGroup>
                            <p:inputText id="discount" value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.headDiscount}"  
                                         style="width: 50%;display: inline!important" >
                                <p:ajax event="blur"
                                        process="@form"
                                        listener="#{invPurchaseInvoiceFormMB.updateSummition()}"
                                        update="invPurchaseInvoiceDetailsTable :form:discount"  />
                            </p:inputText>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.discountType eq 1}" style="margin-right: 5px">
                            <h:panelGroup>
                                <p:outputLabel id="per" style="display: inline!important" value="%"/>
                            </h:panelGroup>
                        </h:panelGroup>

                    </h:panelGroup>



                    <h:panelGroup>
                        <h:panelGroup>
                            <p:outputLabel style="width: 100px" value="الأجمالى بعد الخصم الكلي : "/>
                        </h:panelGroup>

                        <h:panelGroup>
                            <h:outputText id="totalNetAfterDiscount" 
                                          style="text-align:right" 
                                          value="#{invPurchaseInvoiceFormMB.totalNetAfterDiscount}" />
                        </h:panelGroup>
                    </h:panelGroup>


                    <h:panelGroup>
                        <h:panelGroup>
                            <p:selectBooleanCheckbox value="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.taxFlag}" itemLabel="اضافة ضريبة المبيعات"/>
                        </h:panelGroup>
                    </h:panelGroup>


                </h:panelGrid>
            </p:fieldset>


            <h:panelGrid columns="1" cellpadding="5">

                <h:panelGroup>






                    <p:dialog id="dlg" header="أوامر الشراء" widgetVar="dlg2" modal="true" style="height: fit-content">

                        <div >
                            <p:messages id="dilgMsg"
                                        autoUpdate="true" 
                                        showDetail="true" 
                                        rendered="#{invPurchaseInvoiceFormMB.showDialogMessage}"
                                        closable="true"/>   
                        </div>

                        <p:tabView id="tabsBar">

                            <p:tab id="tab1" title="أرقام أوامر الشراء" rendered="#{invPurchaseInvoiceFormMB.purchaseOrderTabView}" >

                                <p:dataTable id="purchaseOrderTable"
                                             draggableColumns="true" 
                                             var="invPurchaseOrderTable" 
                                             widgetVar="invPurchaseOrderTable" 
                                             rowIndexVar="index" 
                                             dir="rtl" 
                                             selection="#{invPurchaseInvoiceFormMB.invPurchaseOrderSelectedList}"
                                             value="#{invPurchaseInvoiceFormMB.invPurchaseOrderList}" 
                                             rows="#{userData.rowListCount}" 
                                             rowKey="#{invPurchaseOrderTable}"
                                             paginator="true" 
                                             emptyMessage="#{userData.userDDs['EMPTY_TABLE']}">


                                    <p:ajax event="toggleSelect" 
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.toggleSelectPurchaseOrder}" 
                                            update=":form:tabsBar" />


                                    <p:ajax event="rowSelectCheckbox"
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.onRowPurchaseOrderSelect}"
                                            update=":form:tabsBar"/>

                                    <p:ajax event="rowUnselectCheckbox"
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.unSelectRow()}"
                                            update=":form:tabsBar"/>

                                    <p:ajax  event="rowSelect" 
                                             process="@form"
                                             listener="#{invPurchaseInvoiceFormMB.onRowPurchaseOrderSelect}"
                                             update=":form:tabsBar " />
                                    <p:ajax event="rowUnselect" 
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.unSelectRow()}" 
                                            update=":form:tabsBar "/>


                                    <p:column selectionMode="multiple" style="width:6vh;text-align:center"/>

                                    <p:column  style="width:3vh;font-size:1.8vh;text-align: right"
                                               filterStyle="display:none" filterBy="#{invPurchaseOrderTable.id}" 
                                               filterMatchMode="contains" headerText="#" >
                                        <p:outputLabel value="#{invPurchaseOrderTable.id}" style="width: 12vh"/>
                                    </p:column>

                                    <p:column style="width:15vh;font-size:1.8vh;text-align: right" 
                                              filterStyle="display:none"
                                              filterBy="#{invPurchaseOrderTable.delegatorId}" 
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['DELEGATOR_NUMBER']}"
                                              sortBy="#{invPurchaseOrderTable.delegatorId}"
                                              >
                                        <p:outputLabel value="#{invPurchaseOrderTable.delegatorId}" />
                                    </p:column>

                                    <p:column style="width:15vh;font-size:1.8vh;text-align: right"
                                              filterStyle="display:none"
                                              filterBy="#{invPurchaseOrderTable.supplierId.name}"
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['SUPPLIER']}" 
                                              sortBy="#{invPurchaseOrderTable.supplierId.name}" 
                                              >
                                        <p:outputLabel value="#{invPurchaseOrderTable.supplierId.name}" />
                                    </p:column>  

                                    <p:column style="width:15vh;font-size:1.8vh;text-align: right"
                                              filterStyle="display:none" filterBy="#{invPurchaseOrderTable.remarks}"
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['REMARK']}" 
                                              sortBy="#{invPurchaseOrderTable.remarks}" >
                                        <p:outputLabel value="#{invPurchaseOrderTable.remarks}" />
                                    </p:column>
                                    <p:column style="width:15vh;font-size:1.8vh;text-align: right"
                                              filterStyle="display:none" 
                                              filterBy="#{invPurchaseOrderTable.supplierReference}"  
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['SUPPLIER_REFERENCE']}" 
                                              sortBy="#{invPurchaseOrderTable.supplierReference}" >
                                        <p:outputLabel value="#{invPurchaseOrderTable.supplierReference}" />
                                    </p:column>  
                                    <p:column style="width:15vh;font-size:1.8vh;text-align: right"
                                              filterStyle="display:none"
                                              filterBy="#{invPurchaseOrderTable.date}" 
                                              filterMatchMode="contains" 
                                              headerText="#{userData.userDDs['DATE']}" 
                                              sortBy="#{invPurchaseOrderTable.date}" >
                                        <p:outputLabel value="#{invPurchaseOrderTable.date}" >
                                            <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                        </p:outputLabel>                           
                                    </p:column>




                                </p:dataTable> 

                            </p:tab>


                            <p:tab id="tab2" title="فواتير استلام بضاعة" rendered="#{invPurchaseInvoiceFormMB.addingOrderTabView}">

                                <p:dataTable id="invAddingOrderTable"
                                             draggableColumns="true"
                                             draggableRows="true"
                                             var="invAddingOrderTable" 
                                             widgetVar="invAddingOrderTable" 
                                             rowIndexVar="index" 


                                             dir="rtl" 
                                             selection="#{invPurchaseInvoiceFormMB.invAddingOrderSelectedList}"

                                             value="#{invPurchaseInvoiceFormMB.invAddingOrderList}"
                                             rows="#{userData.rowListCount}" 
                                             rowKey="#{invAddingOrderTable}"
                                             paginator="true"
                                             emptyMessage="#{userData.userDDs['EMPTY_TABLE']}">

                                    <p:ajax event="toggleSelect" 
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.toggleSelectAddingOrder()}" 
                                            update=":form:tabsBar" />


                                    <p:ajax event="rowSelectCheckbox" 
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.onRowInvAddingOrderSelect}"
                                            update=":form:tabsBar"/>

                                    <p:ajax event="rowUnselectCheckbox"
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.unSelectRow()}"
                                            update=":form:tabsBar"/>

                                    <p:ajax  event="rowSelect" 
                                             process="@form"
                                             listener="#{invPurchaseInvoiceFormMB.onRowInvAddingOrderSelect}"
                                             update=":form:tabsBar"/>

                                    <p:ajax event="rowUnselect" 
                                            process="@form"
                                            listener="#{invPurchaseInvoiceFormMB.unSelectRow()}" 
                                            update=":form:tabsBar"/>

                                    <p:column selectionMode="multiple" style="width:6vh;text-align:center"/>

                                    <p:column style="width:12vh;font-size:1.6vh;text-align: -webkit-auto" filterStyle="display:none" 
                                              filterBy="#{invAddingOrderTable.id}" 
                                              filterMatchMode="contains" 
                                              headerText="رقم الاستلام"
                                              sortBy="#{invAddingOrderTable.id}">
                                        <p:outputLabel value="#{invAddingOrderTable.id}" />
                                    </p:column>

                                    <p:column style="width:10vh;font-size:1.6vh;text-align: -webkit-auto" filterStyle="display:none"
                                              filterBy="#{invAddingOrderTable.organizationSiteId}"
                                              filterMatchMode="contains" 
                                              headerText="#{userData.userDDs['SUPPLIER']}"
                                              sortBy="#{invAddingOrderTable.organizationSiteId}" 
                                              >
                                        <p:outputLabel value="#{invAddingOrderTable.organizationSiteId}" />
                                    </p:column>

                                    <p:column style="width:10vh;font-size:1.6vh;text-align: -webkit-auto" filterStyle="display:none" 
                                              filterBy="#{invAddingOrderTable.date}" 
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['DATE']}"
                                              sortBy="#{invAddingOrderTable.date}" 
                                              >
                                        <p:outputLabel value="#{invAddingOrderTable.date}" >
                                            <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                        </p:outputLabel>                           
                                    </p:column>

                                    <p:column style="width:12vh;font-size:1.6vh;text-align: -webkit-auto" filterStyle="display:none"
                                              filterBy="#{invAddingOrderTable.supplierInvoice}"
                                              filterMatchMode="contains" 
                                              headerText="#{userData.userDDs['SUPPLIER_BILL']}"
                                              sortBy="#{invAddingOrderTable.supplierInvoice}"
                                              >
                                        <p:outputLabel value="#{invAddingOrderTable.supplierInvoice}" />
                                    </p:column>


                                    <p:column style="width:13vh;font-size:1.6vh;text-align: -webkit-auto" filterStyle="display:none"
                                              filterBy="#{invAddingOrderTable.purchaseOrderId.id}" 
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['PURCHASE_NUMBER']}"
                                              sortBy="#{invAddingOrderTable.purchaseOrderId.id}"
                                              >
                                        <p:outputLabel value="#{invAddingOrderTable.purchaseOrderId.id}" />
                                    </p:column> 


                                    <p:column   style="width:16vh;font-size:1.6vh;text-align: -webkit-auto"
                                                filterStyle="display:none"
                                                filterBy="#{invAddingOrderTable.supplierDate}" 
                                                filterMatchMode="contains"
                                                headerText="#{userData.userDDs['BILL_SUPPLIER_DATE']}"
                                                sortBy="#{invAddingOrderTable.supplierDate}"
                                                >
                                        <p:outputLabel value="#{invAddingOrderTable.supplierDate}" >
                                            <f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
                                        </p:outputLabel>
                                    </p:column> 

                                    <p:column style="width:10vh;font-size:1.6vh;text-align: -webkit-auto" filterStyle="display:none"
                                              filterBy="#{invAddingOrderTable.postFlag}" 
                                              filterMatchMode="contains"
                                              headerText="#{userData.userDDs['STATUS']}"
                                              sortBy="#{invAddingOrderTable.postFlag}"
                                              >
                                        <p:outputLabel value="#{invAddingOrderTable.postFlag}" />
                                    </p:column> 


                                </p:dataTable> 

                            </p:tab>
                        </p:tabView>

                        <p:commandButton update="@form dlg" 
                                         icon="fa fa-fw fa-spinner" 
                                         action="#{invPurchaseInvoiceFormMB.loadInvPurchaseOrder()}"
                                         title="تحميل"  >

                        </p:commandButton>

                    </p:dialog>


                </h:panelGroup>

                <h:panelGroup>
                    <p:commandButton style="margin-right:40%"
                                     title="تحميل"
                                     value="تحميل" 
                                     icon="fa fa-fw fa-spinner"
                                     rendered="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id == null}"
                                     action="#{invPurchaseInvoiceFormMB.loadDialog()}"
                                     update="@form"/>

                    <p:commandButton style="margin-left:.2%;margin-right: .1%;width: 90px;" 
                                     ajax="false"
                                     icon="fa fa-fw fa-spinner"
                                     value="جديد" 
                                     onclick="form.target = ''" 
                                     actionListener="#{invPurchaseInvoiceFormMB.reset()}"/>

                    <p:commandButton style="margin-left:.2%;margin-right: .1%;width: 90px;" 
                                     ajax="false"
                                     onclick="form.target = '_blank'"  
                                     icon="fa fa-fw fa-print"
                                     rendered="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id == null}"
                                     value="حفظ وطباعة" 
                                     actionListener="#{invPurchaseInvoiceFormMB.exportPDF}"/>

                    <p:commandButton style="margin-left:.2%;margin-right: .1%;width: 90px;" 
                                     ajax="false"
                                     onclick="form.target = '_blank'"  
                                     icon="fa fa-fw fa-print"
                                     rendered="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id != null}"
                                     value="طباعة" 
                                     actionListener="#{invPurchaseInvoiceFormMB.print}"/>

                    <p:commandButton style="" id="saveB" 
                                     title="#{userData.userDDs['SAVE']}"
                                     value="#{userData.userDDs['SAVE']}" 
                                     rendered="#{invPurchaseInvoiceFormMB.invPurchaseInvoiceEntity.id == null}"
                                     icon="fa fa-fw fa-save"
                                     action="#{invPurchaseInvoiceFormMB.save()}"
                                     update="@form"/>
                    <p:commandButton id="cancel" title="#{userData.userDDs['CANCEL']}" 
                                     value="#{userData.userDDs['CANCEL']}" 
                                     icon="fa fa-fw fa-remove" 
                                     immediate="true"
                                     action="#{invPurchaseInvoiceFormMB.exit()}" 
                                     update="@form"/>


                </h:panelGroup>


            </h:panelGrid>

        </h:form>


        <script>

            document.addEventListener("keydown", function (e) {
                console.log(e.which);
                if (e.which === 13) {
                    e.preventDefault();
                    return false;
                }
                ;
            });

        </script>
    </ui:define>
</ui:composition>
