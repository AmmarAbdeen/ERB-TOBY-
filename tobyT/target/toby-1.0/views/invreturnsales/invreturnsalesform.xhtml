<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../../template/newTemplate.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:define name="content">
        <h:form id="form"  enctype="multipart/form-data"  dir="#{userData.dir}"  style="margin-right: 20px">

            <div >
                <p:messages id="curmsg" autoUpdate="true" showDetail="true" rendered="true" closable="true"/>   
            </div>

            <p:fieldset style="padding: 0 5px" legend="#{userData.userDDs['SALES_RETURN']}"> 

                <div  id="firstSegment" class="ui-g-12 ui-g-nopad">

                    <div class="ui-g">

                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <p:outputLabel style="width: 60px" id="purchId" value="#{userData.userDDs['INVOICE_NO']}" />
                                <p:outputLabel style="width: 60px" id="purchIdVal" value="#{InvReturnSalesFormMB.invReturnSalesEntity.serial}" />
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['DATEE']}*"/>
                                </h:panelGroup>

                                <h:panelGroup>
                                    <p:calendar id="dateFrom" 
                                                disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                value="#{InvReturnSalesFormMB.invReturnSalesEntity.date}"
                                                pattern="dd/MM/yyyy"
                                                required="true"
                                                style="width:47%!important"/>
                                </h:panelGroup>
                            </h:panelGroup>

                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['SALES_INVOI']}"/>
                                </h:panelGroup> 

                                <h:panelGroup>
                                    <p:autoComplete id="purchaseId"
                                                    style="width:83%!important " 
                                                    dropdown="true"

                                                    disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                    converter="#{InvReturnSalesFormMB.invSalesInvoiceConverter}"
                                                    value="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice}"

                                                    var="purchasePerson"
                                                    itemLabel="#{purchasePerson}" 
                                                    itemValue="#{purchasePerson}" 
                                                    forceSelection="true" 
                                                    completeMethod="#{InvReturnSalesFormMB.completePurchaseInvoice}">

                                        <p:ajax update="form"
                                                event="change"
                                                listener="#{InvReturnSalesFormMB.loadPurchaseInvoice()}" />
                                        <p:ajax update="form"
                                                listener="#{InvReturnSalesFormMB.loadPurchaseInvoice()}"
                                                event="itemSelect"/>


                                    </p:autoComplete>
                                </h:panelGroup> 
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['SALES_REPRE']}"/>
                                </h:panelGroup> 

                                <h:panelGroup>
                                    <p:autoComplete style="width: 83%" 
                                                    required="true"
                                                    dropdown="true"
                                                    converter="#{InvReturnSalesFormMB.salesConverter}"
                                                    value="#{InvReturnSalesFormMB.invReturnSalesEntity.salesPerson}"

                                                    disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                    var="person"
                                                    itemLabel="#{person}" 
                                                    itemValue="#{person}" 
                                                    forceSelection="true" 
                                                    completeMethod="#{InvReturnSalesFormMB.completeSalesPerson}" >
                                    </p:autoComplete>
                                </h:panelGroup> 
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">

                            <h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['CUSTOMER']}"/>
                                </h:panelGroup> 
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice ne null}">
                                    <p:outputLabel  
                                        style="width: 70px" value="#{InvReturnSalesFormMB.invReturnSalesEntity.supplierId}"/>

                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}">
                                    <p:autoComplete style="width:83%!important" 
                                                    dropdown="true"
                                                    required="true" requiredMessage="يجب اختيار عميل "
                                                    converter="#{InvReturnSalesFormMB.supplierConvertor}"
                                                    value="#{InvReturnSalesFormMB.invReturnSalesEntity.supplierId}"

                                                    disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                    immediate="true"
                                                    var="supplier"
                                                    itemLabel="#{supplier}" 
                                                    itemValue="#{supplier}" 
                                                    forceSelection="true" 
                                                    completeMethod="#{InvReturnSalesFormMB.completeSuppllier}" >


                                        <p:ajax update="@form"
                                                event="change"
                                                process="@form"
                                                listener="#{InvReturnSalesFormMB.putCurrency}" />
                                        <p:ajax update="@form"
                                                process="@form"
                                                event="itemSelect"
                                                listener="#{InvReturnSalesFormMB.putCurrency}" />


                                    </p:autoComplete>
                                </h:panelGroup> 
                            </h:panelGroup>

                        </div>

                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>

                                <h:panelGroup>
                                    <p:outputLabel style="width: 65px" value="#{userData.userDDs['RETU_TYP']}"/>
                                </h:panelGroup>
                                 <h:panelGroup  rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice ne null}">
                                    <p:outputLabel  
                                      
                                      style="width: 70px" value="#{InvReturnSalesFormMB.invReturnSalesEntity.paymentTypeText}"/>

                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}">
                                    <p:selectOneMenu immediate="true" style="width: 48%" id="console"  value ="#{InvReturnSalesFormMB.invReturnSalesEntity.paymentType}"   >                                                             
                                        <f:selectItem itemLabel="#{userData.userDDs['CASH']}"  itemValue="0"  />                            
                                        <f:selectItem itemLabel="#{userData.userDDs['POSTPONE']}" itemValue="1" />
                                        <f:selectItem itemLabel="#{userData.userDDs['DECOM_CREDIT']}" itemValue="2" />
                                   
                                        <p:ajax update="form" immediate="true"
                                                event="change"
                                                process="@form"
                                                listener="#{InvReturnSalesFormMB.glBankNull}" />
                                        <p:ajax update="form" immediate="true"
                                                process="@form"
                                                event="itemSelect"
                                                listener="#{InvReturnSalesFormMB.glBankNull}" />
                                    </p:selectOneMenu>             
                                </h:panelGroup>

                            </h:panelGroup>

                        </div>

                        <div class="ui-g-12 ui-md-6">

                            <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}">

                                <h:panelGroup>
                                    <p:outputLabel  style="width: 60px" value="#{userData.userDDs['INVOICE_DATE']}"/>
                                </h:panelGroup>

                                <h:outputLabel id="invoiceDateId" value="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice.date}">
                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                </h:outputLabel>

                            </h:panelGroup>

                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup id="currencyPanelGroup">
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['CURRENCY']}"/>
                                </h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" 
                                                   value="#{InvReturnSalesFormMB.invReturnSalesEntity.currencyId}"/>
                                </h:panelGroup>
                            </h:panelGroup>

                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['SINGLE_COST_CENTER']}"/>                        
                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice ne null}">
                                    <p:outputLabel  
                                        style="width: 70px" value="#{InvReturnSalesFormMB.invReturnSalesEntity.costCenter}"/>

                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}">
                                    <p:autoComplete style="width:83%" 
                                                    dropdown="true"
                                                    converter="#{InvReturnSalesFormMB.costCenterConverter}"
                                                    value="#{InvReturnSalesFormMB.invReturnSalesEntity.costCenter}"

                                                    disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                    var="CostCenter"
                                                    itemLabel="#{CostCenter}" 
                                                    itemValue="#{CostCenter}" 
                                                    forceSelection="true" 
                                                    completeMethod="#{InvReturnSalesFormMB.completeCostCenters}" >


                                    </p:autoComplete>
                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">

                            <h:panelGroup>
                                <h:panelGroup id="exchangeRate">
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['RATE']}"/>
                                </h:panelGroup>

                                <h:panelGroup id="CurrencyRate">
                                    <p:outputLabel value="#{InvReturnSalesFormMB.invReturnSalesEntity.rate}"/>
                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.paymentType ne 1}">
                                <h:panelGroup>
                                    <p:outputLabel id="glbank" style="width: 60px" value="#{userData.userDDs['TREASURY']}"/>
                                </h:panelGroup> 
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice ne null}">
                                    <p:outputLabel  
                                        style="width: 70px" value="#{InvReturnSalesFormMB.invReturnSalesEntity.glBankId}"/>

                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}">
                                
                                    <p:autoComplete style="width:83%" 
                                                    dropdown="true"
                                                    required="true"
                                                    converter="#{InvReturnSalesFormMB.glBankConverter}"
                                                    value="#{InvReturnSalesFormMB.invReturnSalesEntity.glBankId}"
                                                    id="glbank1"
                                                    disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                    var="bank"
                                                    itemLabel="#{bank}" 
                                                    itemValue="#{bank}" 
                                                    forceSelection="true" 
                                                    completeMethod="#{InvReturnSalesFormMB.completeGlBank}">

                                        <p:ajax 
                                            event="change"
                                            listener="#{invPurchaseReturnFormMB.hishis()}" />
                                        <p:ajax 
                                            event="itemSelect"
                                            listener="#{invPurchaseReturnFormMB.hishis()}" />

                                    </p:autoComplete>
                                </h:panelGroup> 
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['DEPOSITORY']}"/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice ne null}">
                                    <p:outputLabel  
                                        style="width: 70px" value="#{InvReturnSalesFormMB.invReturnSalesEntity.invInventoryId}"/>

                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}">
                                 
                                    <p:autoComplete style="width:83%" 
                                                    dropdown="true"
                                                    converter="#{InvReturnSalesFormMB.invInventoryConverter}"
                                                    value="#{InvReturnSalesFormMB.invReturnSalesEntity.invInventoryId}"
                                                    required="true"
                                                    var="inventory"
                                                    itemLabel="#{inventory}" 
                                                    itemValue="#{inventory}" 
                                                    forceSelection="true" 
                                                    disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                                    completeMethod="#{InvReturnSalesFormMB.completeInventory}" >

                                        <p:ajax 
                                            event="change"
                                            listener="#{InvReturnSalesFormMB.fillItemMap()}" />
                                        <p:ajax 
                                            event="itemSelect"
                                            listener="#{InvReturnSalesFormMB.fillItemMap()}" />
                                    </p:autoComplete>
                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">

                            <h:panelGroup> 
                                <h:panelGroup>
                                    <p:outputLabel style="width: 60px" value="#{userData.userDDs['NOTE']}"/>
                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice ne null}">
                                    <p:outputLabel  
                                        style="width: 70px" value="#{InvReturnSalesFormMB.invReturnSalesEntity.remark}"/>

                                </h:panelGroup>
                                <h:panelGroup rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}">
                                    <p:inputText style="width: 48%"  id="remarks" 
                                                 disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}" value="#{InvReturnSalesFormMB.invReturnSalesEntity.remark}" />
                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                        <div class="ui-g-12 ui-md-6">
                            <h:panelGroup>
                                <p:dialog id="dlg1" header="#{userData.userDDs['WARNING']}" widgetVar="dlg1" modal="true" height="100" style="height: fit-content">
                                    <p:outputLabel value="#{userData.userDDs['DO_YOU_DELE']}"/>

                                    <br></br>
                                    <p:commandButton  icon="fa fa-confirm"
                                                      title="#{userData.userDDs['YES']}" 
                                                      value="#{userData.userDDs['YES']}"
                                                      actionListener="#{InvReturnSalesFormMB.configmDlg()}"
                                                      update="invReturnPurchaseDetailTable form"
                                                      ajax="true"
                                                      style="float:left"/>

                                    <p:commandButton title="#{userData.userDDs['NO']}" 
                                                     value="#{userData.userDDs['NO']}" 
                                                     actionListener="#{InvReturnSalesFormMB.CloseDlg('dlg1')}"
                                                     update="form"
                                                     icon="fa fa-fw fa-remove" 
                                                     ajax="true"
                                                     style="float:right"/>
                                </p:dialog>

                                <p:dialog id="dlg2" header="#{userData.userDDs['WARNING']}" widgetVar="dlg2" modal="true" height="100" style="height: fit-content">
                                    <p:outputLabel value="#{userData.userDDs['DO_YOU_UPLOAD']}"/>

                                    <br></br>
                                    <p:commandButton icon="fa fa-confirm"
                                                     title="#{userData.userDDs['YES']}"  class="saveButton"
                                                     value="#{userData.userDDs['YES']}"
                                                     actionListener="#{InvReturnSalesFormMB.configmDlg()}"
                                                     update="invReturnPurchaseDetailTable form"
                                                     ajax="true"
                                                     style="float:left"/>

                                    <p:commandButton title="#{userData.userDDs['NO']}"  class="sdeleteButton"
                                                     value="#{userData.userDDs['NO']}" 
                                                     actionListener="#{InvReturnSalesFormMB.CloseDlg('dlg2')}"
                                                     update="form"
                                                     icon="fa fa-fw fa-remove" 
                                                     ajax="true"
                                                     style="float:right"/>
                                </p:dialog>
                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </p:fieldset>

            <br/>

            <p:fieldset id="fieldSetId" legend="#{userData.userDDs['DET_OF_SAL_RETU']}"  style="margin-bottom:20px">

                <p:dataTable id="invReturnPurchaseDetailTable"
                             widgetVar="invReturnPurchaseDetailTable"
                             style="margin-bottom:20px"
                             var="invReturnPurchaseDetailTable"
                             rowIndexVar="index" 
                             dir="rtl" 
                             sortBy="#{1}"
                             emptyMessage="#{userData.userDDs['EMPTY_TABLE']}"
                             selectionMode="single"
                             rowKey="#{invReturnPurchaseDetailTable}"
                             selection="#{InvReturnSalesFormMB.invReturnPurchaseDetailEntitySelected}"
                             value="#{InvReturnSalesFormMB.invReturnPurchaseDetailEntityList}" >

                    <p:ajax event="rowSelect" update="@form"/>

                    <f:facet name="header" >
                        <p:commandButton   class="saddButton" id="addnew"
                                           icon="fa fa-plus"
                                           title="#{userData.userDDs['ADD']}" 
                                           rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}"
                                           disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"

                                           actionListener="#{InvReturnSalesFormMB.addInvPurchaseInvoiceDetail()}" 
                                           update=":form:fieldSetId"  
                                           oncomplete="PrimeFaces.focus('form:invReturnPurchaseDetailTable:'+#{InvReturnSalesFormMB.invReturnPurchaseDetailEntityList.size()}+':invItemNameIn')"
                                           immediate="true"
                                           ajax="true"
                                           style="float:right"/>

                        <p:commandButton class="saddButton" id="addnew2"
                                         icon="fa fa-plus"
                                         title="#{userData.userDDs['ADD']}" 
                                         rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}"
                                         disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                         actionListener="#{InvReturnSalesFormMB.addInvPurchaseInvoiceDetail()}" 
                                         update=":form:fieldSetId"  
                                         oncomplete="PrimeFaces.focus('form:invReturnPurchaseDetailTable:'+#{InvReturnSalesFormMB.invReturnPurchaseDetailEntityList.size()}+':invItemName')"
                                         immediate="true"
                                         ajax="true"
                                         style="float:right"/>
                        
                        <h:commandLink  style="float:left" class="sdcreenimg">  
                            <p:graphicImage name="/img/excel.jpg" width="24"/>  
                            <p:dataExporter type="xls"
                                            target="invReturnPurchaseDetailTable" 
                                            fileName=" مردودات المبيعات"
                                            postProcessor="#{InvReturnSalesFormMB.postProcessXLS}" />  
                        </h:commandLink>
                        <p:outputPanel>
                            <h:outputText value="#{userData.userDDs['SEARCH']} : "  style="font-size: large" />
                            <p:inputText id="globalFilter" onkeyup="PF('invReturnPurchaseDetailTable').filter()" style="width:150px" />
                        </p:outputPanel>
                    </f:facet>


                    <p:column headerText="#" style="width: 5vh;text-align: -webkit-auto" >
                        <h:outputText value="#{invReturnPurchaseDetailTable.serial}"  />
                    </p:column>



                    <p:column style="width: 15vh;text-align: -webkit-auto" 
                              id="itemName2" 
                              rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}"
                              headerText="#{userData.userDDs['ITEM']}"

                              filterBy="#{invReturnPurchaseDetailTable.itemId}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.itemId}"
                              filterable="false">

                        <p:outputLabel rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}" value="#{invReturnPurchaseDetailTable.itemId}" />

                        <p:autoComplete id="invItemName"  
                                        rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id == null}"
                                        style="width:95%"
                                        converter="#{InvReturnSalesFormMB.invSalesInvoiceDetailConverter}"
                                        value="#{invReturnPurchaseDetailTable.purchaseInvoiceDetail}"

                                        var="item"
                                        itemLabel="#{item}" 
                                        itemValue="#{item}" 
                                        forceSelection="true" 
                                        completeMethod="#{InvReturnSalesFormMB.completePurchaseInvoiceDetail}" >

                            <p:ajax update=" discountT costtOut2 QuantityTPurch form:footercalc
                                    unitvalue QuantityT discountT netId totalQuantity totalNet  "
                                    event="change" listener="#{InvReturnSalesFormMB.validateItem(invReturnPurchaseDetailTable)}" />
                            <p:ajax update=" discountT costtOut2 QuantityTPurch form:footercalc
                                    unitvalue QuantityT discountT netId totalQuantity totalNet "
                                    event="itemSelect" listener="#{InvReturnSalesFormMB.validateItem(invReturnPurchaseDetailTable)}" />
                        </p:autoComplete>            
                    </p:column>


                    <p:column style="width: 15vh;text-align: -webkit-auto" 
                              id="itemName" 
                              rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}"
                              headerText="#{userData.userDDs['ITEM']}"

                              filterBy="#{invReturnPurchaseDetailTable.itemId}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.itemId}"
                              filterable="false">

                        <p:outputLabel rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}" value="#{invReturnPurchaseDetailTable.itemId}" />

                        <p:autoComplete id="invItemNameIn"  
                                        rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id == null}"
                                        style="width:95%"
                                        converter="#{InvReturnSalesFormMB.itemsBarcodesDetailsViewConverter}"
                                        value="#{invReturnPurchaseDetailTable.itemsBarcodesDetail}"

                                        var="item"
                                        itemLabel="#{item}" 
                                        itemValue="#{item}" 
                                        forceSelection="true" 
                                        completeMethod="#{InvReturnSalesFormMB.completeItemsData}" >

                            <p:ajax update="unitvalue QuantityT costtOut2 discountT netId totalQuantity totalNet form:footercalc  "
                                    event="change" listener="#{InvReturnSalesFormMB.validateItems(invReturnPurchaseDetailTable)}" />
                            <p:ajax update="unitvalue QuantityT costtOut2 discountT netId totalQuantity totalNet  "
                                    event="itemSelect" listener="#{InvReturnSalesFormMB.validateItems(invReturnPurchaseDetailTable)}" />
                            <p:ajax update="unitvalue QuantityT costtOut2 discountT netId totalQuantity totalNet form:footercalc  "
                                    event="blur" listener="#{InvReturnSalesFormMB.validateItems(invReturnPurchaseDetailTable)}" />


                        </p:autoComplete>            
                    </p:column>



                    <p:column style="width: 12vh;text-align: -webkit-auto"
                              id="Unit" 
                              headerText="#{userData.userDDs['UNIT_NUMBER']}"

                              filterBy="#{invReturnPurchaseDetailTable.itemId.unitId.name}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.itemId.unitId.name}"
                              filterable="false">
                        <p:inputText id="unitvalue"
                                     disabled="true"
                                     value="#{invReturnPurchaseDetailTable.itemId.unitId.name}"
                                     style="width: 95%" />                               
                    </p:column>


                    <p:column style="width: 12vh;text-align: -webkit-auto"
                              id="QUANTITYout" 
                              rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}"
                              headerText="#{userData.userDDs['QUANTITY']}"

                              filterBy="#{invReturnPurchaseDetailTable.quantity}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.quantity}"
                              filterable="false">

                        <p:outputLabel rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}" 
                                       value="#{invReturnPurchaseDetailTable.quantity}" />

                        <p:inputText id="QuantityTPurch"  
                                     value="#{invReturnPurchaseDetailTable.quantity}" 
                                     rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id == null}"
                                     disabled="#{invReturnPurchaseDetailTable.itemId == null}"
                                     style="width:95%">
                            <p:ajax listener="#{InvReturnSalesFormMB.validateQuantityColum(invReturnPurchaseDetailTable)}" 
                                    event="blur"
                                    update=" discountT costtOut2 QuantityTPurch form:footercalc
                                    unitvalue QuantityT discountT netId totalQuantity totalNet"/>
                        </p:inputText>                            
                    </p:column>


                    <p:column style="width: 12vh;text-align: -webkit-auto"
                              id="Quantity"
                              rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}"
                              headerText="#{userData.userDDs['QUANTITY']}"

                              filterBy="#{invReturnPurchaseDetailTable.quantity}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.quantity}"
                              filterable="false">

                        <p:outputLabel rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}" 
                                       value="#{invReturnPurchaseDetailTable.quantity}" />

                        <p:inputText id="QuantityT"  
                                     rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id == null}"
                                     disabled="#{invReturnPurchaseDetailTable.itemsBarcodesDetail == null}"
                                     value="#{invReturnPurchaseDetailTable.quantity}" 
                                     style="width:95%">
                            <p:ajax listener="#{InvReturnSalesFormMB.validateItemQuantity(invReturnPurchaseDetailTable)}" 
                                    update="discountT costtOut2 QuantityTPurch form:footercalc
                                    unitvalue QuantityT discountT netId totalQuantity totalNet "/>
                        </p:inputText>        

                    </p:column>

                    <p:column style="width: 14vh;text-align: -webkit-auto" id="COST" headerText="#{userData.userDDs['PRICE']}"

                              filterBy="#{invReturnPurchaseDetailTable.unitPrice}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.unitPrice}"
                              filterable="false">

                        <h:outputText id="costtOut2" value="#{invReturnPurchaseDetailTable.unitPrice}"/>
                    </p:column>


                    <p:column style="width: 14vh;text-align: -webkit-auto" 
                              rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}"
                              id="DISCOUNT" headerText="#{userData.userDDs['DISCOUNT']}"

                              filterBy="#{invReturnPurchaseDetailTable.discount}" 
                              filterMatchMode="contains" 
                              sortBy="#{invReturnPurchaseDetailTable.discount}"
                              filterable="false">

                        <h:outputText id="discountT" value="#{invReturnPurchaseDetailTable.discount}"/>
                    </p:column>


                    <p:column style="width: 12vh;text-align: -webkit-auto" id="net" headerText="#{userData.userDDs['TOTAL']}">
                        <p:outputLabel id="netId" value="#{invReturnPurchaseDetailTable.net}"   />
                    </p:column>

                    <p:summaryRow>
                        <p:column colspan="3" style="text-align:right">
                            <h:outputText style="text-align:right" value="#{userData.userDDs['TOTAL']}  :" />
                        </p:column>
                        <p:column>
                            <h:outputText id="totalQuantity" value="#{InvReturnSalesFormMB.totalQuatity}"/>
                        </p:column>

                        <p:column rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}"/>
                        <p:column />
                        <p:column>
                            <h:outputText id="totalNet" value="#{InvReturnSalesFormMB.totalNet}"/>
                        </p:column>
                        <p:column />
                    </p:summaryRow>

                    <p:column style="width: 10vh;text-align: -webkit-auto" headerText="#{userData.userDDs['TRANSACTION']}">
                        <p:commandButton  class="saddButton" id="b7" icon="fa fa-plus" 
                                          title="#{userData.userDDs['ADD']}" 
                                          disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                          rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice eq null}"
                                          actionListener="#{InvReturnSalesFormMB.addInvPurchaseInvoiceDetail}" 
                                          update=":form:fieldSetId"  
                                          immediate="true"
                                          oncomplete="PrimeFaces.focus('form:invReturnPurchaseDetailTable:'+#{InvReturnSalesFormMB.invReturnPurchaseDetailEntityList.size()}+':invItemNameIn')"
                                          ajax="true" />

                        <p:commandButton class="saddButton" id="b8" icon="fa fa-plus" 
                                         title="#{userData.userDDs['ADD']}" 
                                         disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                         rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.purchaseInvoice != null}"
                                         actionListener="#{InvReturnSalesFormMB.addInvPurchaseInvoiceDetail}" 
                                         update=":form:fieldSetId"  
                                         immediate="true"
                                         oncomplete="PrimeFaces.focus('form:invReturnPurchaseDetailTable:'+#{InvReturnSalesFormMB.invReturnPurchaseDetailEntityList.size()}+':invItemName')"
                                         ajax="true" />

                        <p:commandButton  class="sdeleteButton" update="invReturnPurchaseDetailTable"
                                          title="#{userData.userDDs['DELETE']}" 
                                          disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                          action="#{InvReturnSalesFormMB.deleteInvPurchaseInvoiceDetail()}"
                                          icon="fa fa-remove" >

                            <f:setPropertyActionListener value="#{invReturnPurchaseDetailTable}"
                                                         target="#{InvReturnSalesFormMB.invReturnPurchaseDetailEntitySelected}"/>
                            <p:confirm header="#{userData.userDDs['COFIGRATION']}" 
                                       message="#{userData.userDDs['ARE_YOU_SURE']}"
                                       />
                        </p:commandButton>

                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton title="#{userData.userDDs['YES']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                            <p:commandButton title="#{userData.userDDs['NO']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                        </p:confirmDialog>
                    </p:column >

                </p:dataTable>


                <p:fieldset id="footercalc" style="padding: 0 5px" legend="الإجماليات">

                    <div  id="firstSegment2" class="ui-g-12 ui-g-nopad">

                        <div class="ui-g">
                            <div class="ui-g-12 ui-md-4">
                                <h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel style="width: 100px" value="#{userData.userDDs['TOTAL']} "/>
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <h:outputText id="totalActualWeight" 
                                                      style="text-align:right" 
                                                      value="#{InvReturnSalesFormMB.invReturnSalesEntity.total}" />
                                    </h:panelGroup>
                                </h:panelGroup>

                            </div>
                            <div class="ui-g-12 ui-md-4">

                                <h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel style="width: 70px" value="#{userData.userDDs['DISC_ON_INVOICE']}"/>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <p:inputText id="discount" value="#{InvReturnSalesFormMB.invReturnSalesEntity.discount}"  
                                                     style="width: 50%;display: inline!important" >
                                            <p:ajax listener="#{InvReturnSalesFormMB.updatefooter()}" update="footercalc"/>
                                        </p:inputText>
                                    </h:panelGroup>

                                </h:panelGroup>

                            </div>
                            <div class="ui-g-12 ui-md-4">

                                <h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel style="width: 100px" value="#{userData.userDDs['TOT_AF_TOT_DIS']}"/>
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <h:outputText id="totalNetAfterDiscount" 
                                                      style="text-align:right" 
                                                      value="#{InvReturnSalesFormMB.invReturnSalesEntity.totalNetAfterDiscount}" />
                                    </h:panelGroup>
                                </h:panelGroup>
                            </div>
                            <div class="ui-g-12 ui-md-4">
                                <h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel style="width: 70px" value="#{userData.userDDs['TAX_VALUE']}"/>
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <p:inputText id="taxvalue" 
                                                      style="text-align:right" 
                                                      value="#{InvReturnSalesFormMB.invReturnSalesEntity.taxvalue}" >
                                            <p:ajax listener="#{InvReturnSalesFormMB.updatefooter()}" update="footercalc"/>
                                        </p:inputText>
                                    </h:panelGroup>
                                </h:panelGroup>
                            </div>
                            <div class="ui-g-12 ui-md-4">
                                <h:panelGroup>
                                    <h:panelGroup>
                                        <p:outputLabel style="width: 100px" value="#{userData.userDDs['NET_TAX']}"/>
                                    </h:panelGroup>

                                    <h:panelGroup>
                                        <h:outputText id="totalWithTaxValue" 
                                                      style="text-align:right" 
                                                      value="#{InvReturnSalesFormMB.invReturnSalesEntity.totalWithTaxValue}" />
                                    </h:panelGroup>
                                </h:panelGroup>
                            </div>
                        </div>
                    </div>
                </p:fieldset>






                <h:panelGroup  style="margin-top: 2%">
                    <div align="center">
                        

                       

                        <p:commandButton class="saveButton" id="saveB" 
                                         title="#{userData.userDDs['SAVE']}"
                                         value="#{userData.userDDs['SAVE']}" 
                                         disabled="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                         icon="fa fa-fw fa-save"
                                         action="#{InvReturnSalesFormMB.saveAndContinue()}"
                                         update="@form"/>
                        
                        <p:commandButton  class="newButton"
                                          id="newN"
                                          ajax="false"
                                          icon="fa fa-fw fa-plus"
                                          value="#{userData.userDDs['NEW']}" 
                                          title="#{userData.userDDs['NEW']}" 
                                          onclick="form.target = ''" 
                                          actionListener="#{InvReturnSalesFormMB.reset()}"/>
                        
                         <p:commandButton  class="printButton"
                                          ajax="false"
                                          onclick="form.target = '_blank'"  
                                          icon="fa fa-fw fa-print"
                                          rendered="#{InvReturnSalesFormMB.invReturnSalesEntity.id != null}"
                                          value="#{userData.userDDs['PRINT']}" 
                                          title="#{userData.userDDs['PRINT']}"
                                          actionListener="#{InvReturnSalesFormMB.print}"/>
                        
                        <p:commandButton  class="cancelButton" id="cancel" 
                                          title="#{userData.userDDs['CANCEL']}" 
                                          value="#{userData.userDDs['CANCEL']}" 
                                          immediate="true"
                                          icon="fa fa-fw fa-backward" 
                                          action="#{InvReturnSalesFormMB.exit()}" 
                                          update="@form"/>
                    </div>

                </h:panelGroup>

            </p:fieldset>



        </h:form>

        <script>

            document.addEventListener("keydown", function (e) {
                if (e.which === 13) {
                    e.preventDefault();
                    return false;
                }
                ;
            });

        </script>
    </ui:define>
</ui:composition>
